good_list="""
Unk
encoder__LAME3.98r____
encoder__LAME3.93____
Unk
encoder__LAME3.98r____
Unk
encoder__LAME3.98r____
encodedby__Itunes_12.3.2.35___
Unk
encoder__LAME3.99r____
encoder__LAME3.98r____
encoder__LAME3.97____
encoder__LAME3.99r____
encodedby__Itunes_12.3.1.23___
Unk
encoder__LAME3.99r____
encoder__LAME3.98r____
encoder__LAME3.97____
encodedby__Itunes_12.3.2.35___
encoder__LAME3.98r____
Unk
encoder__LAME3.92____
Unk
encodedby__Itunes_12.6.2.20___
encoder__LAME3.97____
encoder__LAME3.97____
Unk
Unk
encoder__LAME3.98____
encodedby__Lavf52.31.0____
encoder__LAME3.97____
encoder__LAME3.97____
encoder__LAME3.99r____
Unk
encoder__LAME3.97____
encodedby__Itunes_12.3.2.35___
Unk
encoder__LAME3.97____
Unk
encoder__LAME3.99____
encodedby__Itunes_12.3.2.35___
encodedby__Itunes_12.3.2.35___
encoder__LAME3.98r____
encoder__LAME3.97____
encoder__LAME3.97____
encoder__LAME3.98r____
encodedby__Itunes_12.3.2.35___
encodedby__Itunes_12.3.2.35___
Unk
encoder__LAME3.98____
encoder__LAME3.97____
encodedby__Itunes_12.3.2.35___
encoder__LAME3.97____
Unk
Unk
encoder__LAME3.97____
encoder__LAME3.99r____
encoder__LAME3.97____
Unk
Unk
encoder__LAME3.98____
encoder__LAME3.97____
encoder__LAME3.97____
encoder__LAME3.97____
encoder__LAME3.97____
Unk
encoder__LAME3.99r____
encoder__LAME3.97____
Unk
encoder__LAME3.98r____
Unk
encoder__LAME3.97____
encoder__LAME3.97____
Unk
encoder__LAME3.98r____
Unk
encodedby__Itunes_12.3.2.35___
encoder__LAME3.99r____
Unk
encoder__LAME3.98r____
encoder__LAME3.97____
encodedby__Itunes_12.3.1.23___
encoder__LAME3.97____
encodedby__Itunes_12.3.2.35___
Unk
encoder__LAME3.97____
encoder__LAME3.97____
Unk
encoder__LAME3.97____
Unk
encoder__LAME3.97____
encodedby__Itunes_12.6.1.25___
encoder__LAME3.97____
encoder__LAME3.97____
Unk
encodedby__Itunes_12.3.2.35___
encodedby__Itunes_12.3.2.35___
encodedby__Itunes_12.3.2.35___
encoder__LAME3.92____
Unk
Unk
Unk
Unk
Unk
encodedby__Aryan_l33t____
Unk
Unk
Unk
encoder__LAME3.97____
encoder__LAME3.99r____
Unk
Unk
Unk
encoder__LAME3.98r____
Unk
encoder__LAME3.97____
Unk
Unk
Unk
Unk
encoder__LAME3.97____
Unk
Unk
Unk
encoder__LAME3.98r____
encoder__LAME3.98r____
Unk
Unk
Unk
Unk
Unk
Unk
Unk
encoder__LAME3.97____
encoder__LAME3.99r____
encoder__LAME3.97____
Unk
Unk
encoder__LAME3.99r____
Unk
Unk
encoder__LAME3.97____
Unk
encoder__Lavf57.19.100____
encoder__LAME3.98____
Unk
Unk
Unk
encoder__LAME3.99r____
encoder__LAME3.99r____
Unk
encoder__LAME3.98____
Unk
encoder__LAME3.93____
encoder__LAME3.98r____
encoder__LAME3.99r____
Unk
Unk
encoder__LAME3.99____
encoder__LAME3.98r____
encoder__LAME3.98r____
encoder__LAME3.99r____
Unk
Unk
Unk
Unk
encoder__LAME3.97____
Unk
encoder__LAME3.97____
encoder__LAME3.97____
Unk
Unk
Unk
encoder__LAME3.98r____
encoder__LAME3.90a____
encoder__LAME3.90a____
Unk
encoder__LAME3.98r____
encoder__LAME3.99r____
Unk
Unk
Unk
encoder__LAME3.98r____
encoder__Lavf57.19.100____
encoder__Lavf57.19.100____
encoder__LAME3.97____
encoder__LAME3.98r____
encoder__LAME3.97____
encoder__LAME3.99r____
encoder__LAME3.98b____
Unk
encoder__LAME3.99r____
Unk
encodedby______
Unk
encoder__LAME3.98r____
encoder__LAME3.98r____
encoder__LAME3.98r____
Unk
encoder__LAME3.98r____
Unk
Unk
encoder__LAME3.97____
Unk
Unk
Unk
Unk
Unk
Unk
Unk
encoder__LAME3.97____
encoder__LAME3.97____
encoder__LAME3.97____
Unk
Unk
encoder__LAME3.98r____
encoder__LAME3.99a____
Unk
Unk
encoder__LAME3.98r____
encodedby__Maxximix____
encoder__LAME3.98r____
encoder__LAME3.99r____
encoder__LAME3.98r____
Unk
Unk
encoder__LAME3.97____
Unk
Unk
encoder__Play_MPE___
Unk
Unk
Unk
Unk
Unk
Unk
Unk
Unk
encoder__LAME3.99r____
Unk
Unk
Unk
encoder__LAME3.98r____
Unk
encoder__LAME3.98r____
encoder__LAME3.98r____
encoder__LAME3.98r____
Unk
Unk
encoder__LAME3.97____
encoder__LAME3.97____
Unk
Unk
encoder__LAME3.98r____
Unk
encoder__LAME3.98r____
encoder__LAME3.99r____
Unk
Unk
Unk
Unk
Unk
Unk
encoder__Lavf____
"""



bad_list="""
Unk
encodedby__Lame_3.98.4___
Unk
encoder__Lavf____
Unk
encoder__Lavf____
Unk
Unk
Unk
Unk
Unk
Unk
Unk
encodedby__Lame_3.98___
encoder__Lavf____
Unk
Unk
Unk
Unk
Unk
encodedby__Lame_3.98___
Unk
encodedby__Lame_3.98___
Unk
encoder__Lavf____
Unk
encoder__Lavc56.19____
encoder__Lavf54.20.4____
Unk
encoder__Lavc57.24____
encodedby__Lame_V3.98.4_(-v0)__
Unk
Unk
Unk
encoder__Lavf52.111.0____

"""


import pandas as pd
from io import StringIO
import re

def lame_heuristic(st, keep_ver=True):
    bad_lame = False
    if ((st == "LAME3.99.5") or
       (st == "LAME3.99") or 
       (st == "LAME3.98")
       #or (st == "LAME3.99.5ªªÁ")
       ):
        bad_lame = True

    if keep_ver:
        if bad_lame:
            ret = st
        else:
            ret = "LAME_OTHERS"
    else:
        if bad_lame:
            ret = "LAME_BAD"    
        else:
            ret = "LAME_GOOD"
        
    return ret

def av_heuristic(st, keep_ver=True):
    bad_lame = False
    st = st.lower()
    if st.find("av") >= 0:
        ret="AV"
    elif st.find("lame") >= 0:
        ret="LAME"
    elif st.find("itunes") >= 0:
        ret="ITUNES"
    elif st == "unk":
        ret = "missing_tag"
    else:    
        ret = "OTHER"
    return ret


def read_list(st, tag):
    df = pd.read_csv(StringIO(st), names=['version'])
    #s = df['version'].str.replace(" ","_").fillna('unk')
    
    #df = pd.DataFrame(s, columns=["version"])
    df['shift']=tag
    
    df['heuristic'] = df['version'].apply(av_heuristic)
    return df

def do_stats(df1, index, columns, normalize=False):
    df2 = pd.crosstab(index=df1[index], columns=df1[columns], normalize=normalize)
    df2 = df2.sort_values([df2.columns[0],df2.columns[1]], ascending=False)
    if normalize:
        df2 = df2.round(3)*100.0
    return df2

def add_fp_col(a):
    fp_list=[]
    for i in range(len(a)):
        row = a.iloc[i]
        bad = row[0]
        good = row[1]
        if i == len(a) - 1:
            num = bad
        else:
            num = good
        fp = num * 100.0 / (bad+good)
        #print(fp*100.0) #.round(3)
        fp_list.append(fp)

    a['False Positive %']=fp_list
    a['False Positive %']=a['False Positive %'].round(1)
    return a


df_good = read_list(good_list, 'good_shift')
df_bad  = read_list(bad_list, 'bad_shift')

df_both = pd.concat([df_good, df_bad], ignore_index=True)

print("\n\nNumber of mp3 samples: %d  (%d good / %d bad)     Percentage Bad shifts: %.1f%%\n" % (len(df_both), len(df_good), len(df_bad), len(df_bad)*100.0/len(df_both)))

stats = do_stats(df_both, index='heuristic', columns='shift')
#stats = add_fp_col(stats)
stats

